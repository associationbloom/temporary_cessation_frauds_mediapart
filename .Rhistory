label = ifelse(label < 10, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 10, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 10, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, dpi = 300)
#Load necessary scripts
source("Scripts/Functions/load_packages.R") #Load packages
source("Scripts/Others/plot_themes.R") #Load plot themes
#Create function to stylize tables
table <- function(df, caption) {
options(knitr.kable.NA = "")
df %>%
kbl(caption = caption) %>%
kable_paper(full_width = TRUE) %>%
kable_styling(bootstrap_options = c("striped", "condensed", "responsive", "hover")) %>%
row_spec(0, bold = TRUE) %>%
collapse_rows(columns = 1:1, valign = "top") %>%
scroll_box(width = "100%")
}
# fleet <- read.csv2("https://www.dropbox.com/s/3xc7t2o76ccudqe/vesselRegistryListResults-2021_12_17.csv?dl=1", quote = "", stringsAsFactors = FALSE)
fleet <- read.csv2("Data/Raw/vesselRegistryListResults-2021_12_17.csv", quote = "", stringsAsFactors = FALSE)
#Load raw data from EU website
fleet <- fleet %>%
filter(!LOA == "" & !Country.of.Registration == "\"\"") %>% #Set aside correct records
bind_rows(fleet %>% #Deal with incorrect records (duplicate rows that incorrectly tabulated)
filter(Country.of.Registration == "\"\"") %>% #Set aside first part of duplicate records
select(c(Event:Power.of.main.engine)) %>%
rename_at(vars(colnames(fleet %>% #Rename columns based on correct records
filter(Country.of.Registration == "\"\"") %>%
select(c(Event:Power.of.main.engine)))),
~ colnames(fleet %>%
select(c(IRCS.indicator:ncol(.))))) %>%
bind_cols(fleet %>% #Bind fixed duplicates with other part of duplicate records
filter(LOA == "") %>%
select(c(1:Name.of.vessel))) %>%
mutate(Place.of.registration = "",
IRCS = "",
Hull.material = as.integer(Hull.material)))
fleet <- fleet %>%
select(country = Country.of.Registration, #Keep columns of interest and rename them
cfr = CFR,
external_marking = External.marking,
vessel_name = Name.of.vessel,
event_start_date = Event.Start.Date,
event_end_date = Event.End.Date,
gear_code = Main.fishing.gear,
length = LOA,
power = Power.of.main.engine)
fleet <- fleet %>%
mutate(across(where(is.character), str_trim), #Remove all trailing and leading whitespace
external_marking = str_remove_all(external_marking, c("\\\"|\\\r|\\\n|\\*|/UFA| ?|-?")), #Remove these patterns
external_marking = str_replace(external_marking, "^([a-zA-Z]+)(0|-)([0-9]+)$", "\\1\\3"), #Further clean external_marking
vessel_name = str_to_upper(str_replace(vessel_name, "-", " ")), #Capitalize vessel_name
vessel_name = str_replace(vessel_name, "  ", " "), #Remove double spaces
event_start_date = as.Date(event_start_date, origin = "1899-12-30"), #Make dates actual dates
event_end_date = as.Date(ifelse(event_end_date == "2100-12-31", "2021-04-19", event_end_date), origin = "1899-12-30"), #Replace last records by download date and make dates actual dates
length = as.numeric(length)) %>% #Convert as numeric
distinct()
fleet <- fleet %>%
left_join(read.xlsx("https://www.dropbox.com/s/57dqlccmu1i8r99/MDR_Gear_Type.xlsx?dl=1") %>% #Downloaded on the European Commission's CIRCABC platform
select(gear_code = Code,
gear = EnDescription,
gear_cat = SubCategory) %>%
#Cleaning gear and gear_cat
mutate(gear = str_to_sentence(str_remove(gear, "- ")),
gear = ifelse(grepl("know", ignore.case = TRUE, gear), "Unknown gear", gear),
gear_cat = ifelse(grepl("mid", ignore.case = TRUE, gear_cat), "Pelagic trawls & seines",
ifelse(grepl("bottom", ignore.case = TRUE, gear_cat), "Bottom trawls & dredges",
ifelse(grepl("surround", ignore.case = TRUE, gear), "Pelagic trawls & seines",
ifelse(grepl("gill|trammel", ignore.case = TRUE, gear), "Entangling nets",
ifelse(grepl("long", ignore.case = TRUE, gear), "Longlines",
ifelse(grepl("line", ignore.case = TRUE, gear), "Hook & lines",
ifelse(grepl("hand|beach", ignore.case = TRUE, gear), "Other gears",
ifelse(grepl("dredge", ignore.case = TRUE, gear), "Bottom trawls & dredges",
ifelse(grepl("bottom|danish|scottish", ignore.case = TRUE, gear), "Bottom trawls & dredges",
ifelse(grepl("trawl", ignore.case = TRUE, gear), "Undet. trawls",
ifelse(grepl("pot|trap|pound|fyke|weir", ignore.case = TRUE, gear), "Pots & traps",
ifelse(grepl("purse|seine", ignore.case = TRUE, gear) & !grepl("PS", gear_code), "Pelagic trawls & seines",
ifelse(grepl("PS", ignore.case = TRUE, gear_code), "Purse seines",
ifelse(grepl("unknown", ignore.case = TRUE, gear), "Undet.", "Other gears"))))))))))))))) %>%
#Adding missing gears
add_row(gear_code = c("", "FDV", "GES", "HMS", "LVS", "NS", "SDV", "OTS", "000"),
gear = c("Unknown gear", "Free diving", "Undet. nets", "Undet. dredges", "Set vertical lines", "Unknown gear", "Undet. bottom seines", "Undet. twin trawls", "Unknown gear"),
gear_cat = c("Undet.", "Other gears", "Entangling nets ", "Bottom trawls & dredges", "Hook & lines", "Undet.", "Bottom trawls & dredges", "Undet. trawls", "Undet.")),
by = "gear_code") %>%
select(-gear_code)
fleet <- setDT(fleet)
fleet <- fleet[,.(event_start_date = min(event_start_date),
event_end_date = max(event_end_date)) ,
by = .(rleid(country, cfr, external_marking, vessel_name, gear, gear_cat, length, power),
country,
cfr,
external_marking,
vessel_name,
gear,
gear_cat,
length, power)] %>%
select(-rleid) %>%
filter(!event_end_date < "2014-01-01")
emff <- read.xlsx("https://www.dropbox.com/s/ad6vbab7zqgkhck/T%C3%A9l%C3%A9charg%C3%A9%20le%2010-11-2021-Openbaarmaking_EFMZV_oktober_2021.xlsx?dl=1")
emff <- emff %>%
select(beneficiary = Naam.van.de.begunstigde,
cfr = Community.Fleet.Registry.identificatienummer,
project_name = Naam.van.de.concrete.actie,
project_description = Samenvatting.van.de.concrete.actie,
project_start = Begindatum.van.de.concrete.actie,
project_end = Einddatum.van.de.concrete.actie,
payment_date = `Datum.subsidie-vaststellingen`,
subsidy_total = Totale.subsidiabele.uitgaven,
subsidy_eu = Bedrag.van.de.bijdrage.van.de.Unie,
zip_code = Postcode.van.de.concrete.actie,
eu_priority = Vermelding.van.de.betrokken.Unieprioriteit)
emff <- emff %>%
mutate(across(where(is.character), str_trim), #Remove all trailing and leading whitespace
across(contains(c("start", "end", "date")), ~as.Date(as.character(.), format = "%Y%m%d")),
eu_priority = case_when(eu_priority == "UP1" ~ "Fisheries",
eu_priority == "UP2" ~ "Aquaculture",
eu_priority == "UP3" ~ "Common Fisheries Policy",
eu_priority == "UP4" ~ "Community-led local development strategies",
eu_priority == "UP5" ~ "Marketing and processing",
eu_priority == "UP6" ~ "Integrated Maritime Policy"))
emff_covid <- emff %>%
filter_all(any_vars(grepl("stilliggen", ., ignore.case = TRUE) & grepl("covid", ., ignore.case = TRUE))) # 'Stilliggen' is Dutch for 'cessation'
emff_covid <- emff_covid %>%
mutate (id = 1:n()) %>%
left_join(fleet,
by = "cfr") %>%
rowwise() %>%
mutate(ndays = pmax(pmin(project_end, event_end_date) - pmax(project_start, event_start_date) + 1,0)) %>% #Calculate interval overlap and set to 0 if no overlap
with_groups(id, filter, ndays == max(ndays)) %>% #Keep most overlapping records
distinct()
# Case where there is no overlapping periods between our dataset and the fleet register
if (emff_covid %>% filter (ndays == 0) %>% nrow () > 0) {
emff_covid <- emff_covid %>%
filter (ndays > 0) %>%
bind_rows(emff_covid %>%
filter(ndays == 0) %>%
mutate (ndays = abs(pmin(project_end, event_end_date) - pmax(project_start, event_start_date) + 1)) %>%
with_groups(id, filter, ndays == min(ndays)))
}
# Case where there is two or more exact same overlapping for a given CFR, e.g., one record of our dataset corresponding to one CFR has the same number of overlapping days with two or more records in the fleet register. This is a problem because it duplicates the record of our dataset.
if (emff_covid %>% with_groups(id, mutate, count = n()) %>% filter (count > 1) %>% nrow () > 0) {
emff_covid <- emff_covid %>%
with_groups(id, mutate, count = n()) %>%
filter (count == 1) %>%
bind_rows(emff_covid %>%
with_groups(id, mutate, count = n()) %>%
filter (count > 1) %>%
with_groups(id, slice, 1))
}
emff_covid <- emff_covid %>%
select (-c("event_start_date", "event_end_date", "ndays", "count", "id"))
emff_covid <- emff_covid %>%
filter(!external_marking %in% c("WR226", "HK86"))
emff_covid <- emff_covid %>%
mutate (power = as.numeric(power),
week_subsidy = ifelse(power*1.34102209 < 260, subsidy_total/2200, # 1.34102209 is the conversion factor from kW to cv
ifelse(power*1.34102209>260 & power*1.34102209<300, subsidy_total/4400,
ifelse(power*1.34102209>300, subsidy_total/8800, NA))))
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Senne démersale",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Chalut à panneaux",
ifelse(gear == "Beam trawls", "Chalut à perche",
ifelse(gear == "Pots", "Casier",
ifelse(gear == "Set gillnets (anchored)", "Filet maillant", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Chalut à perche", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Classe de taille des navires", y ="Subventions reçues pour les arrêts temporaires (million EUR)", fill = "Engin de pêche") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
test <- emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Senne démersale",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Chalut à panneaux",
ifelse(gear == "Beam trawls", "Chalut à perche",
ifelse(gear == "Pots", "Casier",
ifelse(gear == "Set gillnets (anchored)", "Filet maillant", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Chalut à perche", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m")))
View(test)
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
test <- emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m")))
test <- emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n()) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m")))
test <- emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n())
test <- emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n()) %>% ungroup () %>% summarise (sum(label))
# Let's load the GFW data
gfw_data <- read.xlsx("Data/Processed/GFW_data.xlsx") %>%
mutate_at(vars(c("project_start", "project_end", "fishing_start_gfw", "fishing_end_gfw", "ais_off_begin_gfw", "ais_off_end_gfw")), ~as.Date(., origin = "1899-12-30")) %>%
select (-data_acquisition, -access, -cfr, -mmsi, -vessel_name, -last_check) %>%
mutate(fishing_period = interval(fishing_start_gfw, fishing_end_gfw)) %>%
mutate(ais_off_period = interval(ais_off_begin_gfw, ais_off_end_gfw)) %>%
select (-c("fishing_start_gfw", "fishing_end_gfw", "ais_off_begin_gfw", "ais_off_end_gfw")) %>%
pivot_longer(cols = c("fishing_period", "ais_off_period"), names_to = "action", values_to = "time_period") %>%
arrange(external_marking, time_period) %>%
filter(!is.na(time_period))
vessel_not_found <- read.xlsx("Data/Processed/GFW_data.xlsx") %>%
filter (grepl("Not found",access)) %>%
select (external_marking)
emff_covid <- emff_covid %>%
left_join(gfw_data %>%
filter(action == "ais_off_period") %>%
select (external_marking) %>%
distinct() %>%
mutate (culprit_ais_off = "TRUE"), by = "external_marking") %>%
mutate (culprit_ais_off = ifelse(is.na(culprit_ais_off) & !external_marking %in% c(vessel_not_found %>% pull ()), "FALSE", culprit_ais_off))
emff_covid <- emff_covid %>%
filter (!is.na(culprit_ais_off))
emff_covid <- emff_covid %>%
filter (length >= 15)
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Demersal seine",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Otter trawl",
ifelse(gear == "Beam trawls", "Beam trawl",
ifelse(gear == "Pots", "Pot",
ifelse(gear == "Set gillnets (anchored)", "Gillnets", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Beam trawl", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Vessel length class", y ="Subsidies received for temporary cessation (million EUR)", fill = "Fishing gear", caption = "This plot includes all vessels that received subsidies for temporary\ncessation, i.e. those that landed in PEFA and those that did not.") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Senne démersale",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Chalut à panneaux",
ifelse(gear == "Beam trawls", "Chalut à perche",
ifelse(gear == "Pots", "Casier",
ifelse(gear == "Set gillnets (anchored)", "Filet maillant", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Chalut à perche", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Classe de taille des navires", y ="Subventions reçues pour les arrêts temporaires (million EUR)", fill = "Engin de pêche") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Senne démersale",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Chalut à panneaux",
ifelse(gear == "Beam trawls", "Chalut à perche",
ifelse(gear == "Pots", "Casier",
ifelse(gear == "Set gillnets (anchored)", "Filet maillant", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Chalut à perche", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m")),
gear = factor(gear, levels = c("Chalut à perche", "Chalut à panneaux", "Senne démersale", "Casier", "Filet maillant"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Classe de taille des navires", y ="Subventions reçues pour les arrêts temporaires (million EUR)", fill = "Engin de pêche") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Senne démersale",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Chalut à panneaux",
ifelse(gear == "Beam trawls", "Chalut à perche",
ifelse(gear == "Pots", "Casier",
ifelse(gear == "Set gillnets (anchored)", "Filet maillant", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Chalut à perche", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m")),
gear = factor(gear, levels = c("Filet maillant", "Casier", "Senne démersale", "Chalut à panneaux", "Chalut à perche"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Classe de taille des navires", y ="Subventions reçues pour les arrêts temporaires (million EUR)", fill = "Engin de pêche") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
ggplot(emff_covid %>%
mutate(class_length = ifelse(length < 12, "<12 m",
ifelse(length >= 12 & length < 25, "12-25 m", #Official FranceAgriMer classification
ifelse(length >= 25 & length < 40, "25-40 m", ">40 m")))) %>%
mutate(gear = ifelse(gear %in% c("Scottish seines", "Danish seines", "Pair seines"), "Senne démersale",
ifelse(gear %in% c("Single boat bottom otter trawls", "Twin bottom otter trawls"), "Chalut à panneaux",
ifelse(gear == "Beam trawls", "Chalut à perche",
ifelse(gear == "Pots", "Casier",
ifelse(gear == "Set gillnets (anchored)", "Filet maillant", gear)))))) %>%
group_by(class_length, gear) %>%
summarise(subsidy = sum(subsidy_total), subsidy = subsidy/10^6,
label = n(),
label = ifelse(label < 5, "", as.character(label))) %>%
ungroup() %>%
add_row (class_length = "<12 m", gear = "Chalut à perche", subsidy = 0, label = "") %>% # we add a row for the <12 m size class, since it did not received any subsidies.
mutate(class_length = factor (class_length, levels = c("<12 m", "12-25 m", "25-40 m", ">40 m")),
gear = factor(gear, levels = c("Chalut à perche", "Chalut à panneaux", "Senne démersale", "Casier", "Filet maillant"))), aes(x=class_length, y=subsidy, fill = gear)) +
geom_col (color = "grey0") +
geom_text (aes(label = label), fontface = "bold", color = "grey100", position = position_stack(vjust = .5)) +
labs (x="Classe de taille des navires", y ="Subventions reçues pour les arrêts temporaires (million EUR)", fill = "Engin de pêche") +
theme_bw () %+%
theme(plot.caption= element_text(hjust = 0)) +
scale_fill_viridis_d ()
ggsave(last_plot(), file = "Output/Figures/Subsidies received for temporary cessation.png", width = 30, height = 15, unit = "cm")
